# Copyright (C) 2001-2003
# William E. Kempf
#
# Permission to use, copy, modify, distribute and sell this software
# and its documentation for any purpose is hereby granted without fee,
# provided that the above copyright notice appear in all copies and
# that both that copyright notice and this permission notice appear
# in supporting documentation.  William E. Kempf makes no representations
# about the suitability of this software for any purpose.
# It is provided "as is" without express or implied warranty.
#
# Boost.Threads build Jamfile
#
# Additional configuration variables used:
#   1. PTW32 may be used on Win32 platforms to specify that the pthreads-win32
#      library should be used instead of "native" threads. This feature is
#      mostly used for testing and it's generally recommended you use the
#      native threading libraries instead. PTW32 should be set to be a list
#      of two strings, the first specifying the installation path of the
#      pthreads-win32 library and the second specifying which library
#      variant to link against (see the pthreads-win32 documentation).
#      Example: jam -sPTW32="c:\pthreads-win32 pthreadVCE.lib"

# Declare the location of this subproject relative to the root.
subproject libs/thread/build ;

# Include threads.jam for Boost.Threads global build information.
# This greatly simplifies the Jam code needed to configure the build
# for the various Win32 build types.
import ./threads ;

{
    CPP_SOURCES = 
        barrier 
        condition 
        exceptions 
        mutex 
        named
        once
        recursive_mutex 
        read_write_mutex
        shared_memory 
        thread 
        threadmon 
        thread_pool 
        tss 
        xtime 
        ;

    template boost_thread_lib_base
        : ## sources ##
          <template>thread_base
          ../src/$(CPP_SOURCES).cpp
        : ## requirements ##
          <define>BOOST_THREAD_BUILD_LIB=1
          <runtime-link>static
          # the common names rule ensures that the library will
          # be named according to the rules used by the install
          # and auto-link features:
          common-variant-tag 
        : ## default build ##
    ;

    template thread_dll_base
        : ## sources ##
          <template>thread_base 
          ../src/$(CPP_SOURCES).cpp
        : ## requirements ##
          <define>BOOST_THREAD_BUILD_DLL=1
          <runtime-link>dynamic
          # the common names rule ensures that the library will
          # be named according to the rules used by the install
          # and auto-link features:
          common-variant-tag 
        : ## default build ##
    ;

    lib $(boost_thread_lib_name)
        : ## sources ##
          <template>boost_thread_lib_base
        : ## requirements ##
          <define>BOOST_THREAD_LIB_NAME=$(boost_thread_lib_name)
        : ## default build ##
    ;

    dll $(boost_thread_lib_name)
        : ## sources ##
          <template>thread_dll_base 
        : ## requirements ##
          <define>BOOST_THREAD_LIB_NAME=$(boost_thread_lib_name)
        : ## default build ##
    ;

    stage bin-stage
        : <dll>$(boost_thread_lib_name)
          <lib>$(boost_thread_lib_name)
    ;

    install thread lib
        : <dll>$(boost_thread_lib_name)
          <lib>$(boost_thread_lib_name)
    ;

    if $(boost_thread_lib_settings_ptw32)
    {
        lib $(boost_thread_lib_name_ptw32)
            : ## sources ##
              <template>boost_thread_lib_base
            : ## requirements ##
              <define>BOOST_THREAD_LIB_NAME=$(boost_thread_lib_name_ptw32)
              $(pthreads-win32)
        ;

        dll $(boost_thread_lib_name_ptw32)
            : ## sources ##
              <template>thread_dll_base
            : ## requirements ##
              <define>BOOST_THREAD_LIB_NAME=$(boost_thread_lib_name_ptw32)
              $(pthreads-win32)
        ;

        stage bin-stage
            : <dll>$(boost_thread_lib_name_ptw32)
              <lib>$(boost_thread_lib_name_ptw32)
        ;

        install thread lib
            : <dll>$(boost_thread_lib_name_ptw32)
              <lib>$(boost_thread_lib_name_ptw32)
        ;
    }
}
